<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rooms - Hostel Management</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="dashboard">
    <nav class="navbar">
        <h2>üè® Hostel Management</h2>
        <div class="nav-links">
            <a href="dashboard.html">Dashboard</a>
            <a href="rooms.html" class="active">Rooms</a>
            <a href="students.html">Students</a>
            <a href="bookings.html">Bookings</a>
            <a href="feedback.html">Feedback</a>
        </div>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </nav>

    <div class="container">
        <div class="content-section">
            <div class="section-header">
                <h2>Room Management</h2>
                <button class="btn-primary" onclick="openModal()">Add Room</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Room Number</th>
                        <th>Type</th>
                        <th>Capacity</th>
                        <th>Price</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="roomsTable">
                    <!-- Rooms will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="roomModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add Room</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="roomForm">
                <input type="hidden" id="roomId">
                <div class="form-group">
                    <label>Room Number</label>
                    <input type="text" id="roomNumber" required>
                </div>
                <div class="form-group">
                    <label>Room Type</label>
                    <select id="roomType" required>
                        <option value="Single">Single</option>
                        <option value="Double">Double</option>
                        <option value="Triple">Triple</option>
                        <option value="Quad">Quad</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Capacity</label>
                    <input type="number" id="capacity" required min="1">
                </div>
                <div class="form-group">
                    <label>Price</label>
                    <input type="number" id="price" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="status">
                        <option value="available">Available</option>
                        <option value="occupied">Occupied</option>
                        <option value="maintenance">Maintenance</option>
                    </select>
                </div>
                <button type="submit" class="btn">Save</button>
            </form>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        checkAuth();
        let editingId = null;

        async function loadRooms() {
            const rooms = await apiCall('/rooms');
            if (rooms) {
                const tbody = document.getElementById('roomsTable');
                tbody.innerHTML = rooms.map(room => `
                    <tr>
                        <td>${room.room_number}</td>
                        <td>${room.room_type}</td>
                        <td>${room.capacity}</td>
                        <td>$${room.price}</td>
                        <td><span class="badge badge-${room.status === 'available' ? 'success' : room.status === 'occupied' ? 'danger' : 'warning'}">${room.status}</span></td>
                        <td class="action-btns">
                            <button class="btn-edit" onclick="editRoom(${room.id})">Edit</button>
                            <button class="btn-delete" onclick="deleteRoom(${room.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        function openModal() {
            editingId = null;
            document.getElementById('modalTitle').textContent = 'Add Room';
            document.getElementById('roomForm').reset();
            document.getElementById('roomModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('roomModal').classList.remove('active');
        }

        async function editRoom(id) {
            const rooms = await apiCall('/rooms');
            const room = rooms.find(r => r.id === id);
            if (room) {
                editingId = id;
                document.getElementById('modalTitle').textContent = 'Edit Room';
                document.getElementById('roomNumber').value = room.room_number;
                document.getElementById('roomType').value = room.room_type;
                document.getElementById('capacity').value = room.capacity;
                document.getElementById('price').value = room.price;
                document.getElementById('status').value = room.status;
                document.getElementById('roomModal').classList.add('active');
            }
        }

        async function deleteRoom(id) {
            if (confirm('Are you sure you want to delete this room?')) {
                const result = await apiCall(`/rooms/${id}`, 'DELETE');
                if (result && result.success) {
                    showAlert('Room deleted successfully');
                    loadRooms();
                }
            }
        }

        document.getElementById('roomForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                room_number: document.getElementById('roomNumber').value,
                room_type: document.getElementById('roomType').value,
                capacity: parseInt(document.getElementById('capacity').value),
                price: parseFloat(document.getElementById('price').value),
                status: document.getElementById('status').value
            };
            
            const endpoint = editingId ? `/rooms/${editingId}` : '/rooms';
            const method = editingId ? 'PUT' : 'POST';
            
            const result = await apiCall(endpoint, method, data);
            if (result && result.success) {
                showAlert(result.message);
                closeModal();
                loadRooms();
            }
        });

        loadRooms();
    </script>
</body>
</html>
